<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bike List</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/bikes.css' %}" /> <!-- Here are loaded the styles from the static folder -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  </head>
  <body>
    <header class="d-flex justify-content-center py-3"> <!-- Starts Navbar -->
      <ul class="nav nav-pills">
        <li class="nav-item">
          <a href="#" class="nav-link active" aria-current="page">Bike List</a>
        </li>
        <li class="nav-item">
          <a href="{% url 'bike_create' %}" class="nav-link">Bike Form</a> <!-- URL to go to the creating bikes form -->
        </li>
      </ul>
    </header> <!-- Ends Navbar -->

    <div class="container">
      {% for bike in bikes %} <!-- for loop to load all the bikes -->
        {% if forloop.first or forloop.counter0|divisibleby:3 %} <!-- When row hits 3 bikes, a new row is created -->
          {% if not forloop.first %}
            </div> <!-- Close previous row -->
          {% endif %}
          <div class="row"> <!-- Start new row -->
        {% endif %}
        <div class="col-md-4"> <!-- Column for the card -->
          <div class="card my-2 relative" style="width: 18rem; background-color: rgb(29, 29, 29); border:solid, white, 2px;"> <!-- Starts card -->
            <img src="{{ bike.image }}" class="card-img-top" alt="Bike Image" style="height:200px"/> <!-- Bike image is loaded -->
            <div class="card-body">
              <h5 class="card-title my-auto start-50" style="color: white"> {{ bike.reference }}</h5> <!-- Bike reference is loaded -->
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item" style="background-color: rgb(29, 29, 29);">
                <p style="color: white" class="my-auto start-50">{{ bike.trademark }}</p> <!-- Bike trademark is loaded -->
              </li>
              <li class="list-group-item" style="background-color: rgb(29, 29, 29);">
                <p style="color: white" class="my-auto start-50">{{ bike.model }}</p> <!-- Bike model is loaded -->
              </li>
              <li class="list-group-item" style="background-color: rgb(29, 29, 29);">
                <p style="color: white" class="my-auto start-50">{{ bike.price }}</p> <!-- Bike price is loaded -->
              </li>
              <li class="list-group-item" style="background-color: rgb(29, 29, 29);">
                <p style="color: white" class="my-auto start-50">{{ bike.supplier }}</p> <!-- Bike supplier is loaded -->
              </li>
            </ul>
            <div class="card-body"> <!-- Space for the buttons -->
              <button type="button" class="btn btn-primary">
                <a href="{% url 'bike_edit' bike.id %}" style="color: white; text-decoration: none;">Edit</a> <!-- Edit button with bike.id to go to the editing URL -->
              </button>
              <button type="button" class="btn btn-danger" onclick="confirmDelete({{ bike.id }})">Delete</button> <!-- Delete button with bike.id to go to the deleting URL -->
            </div>
          </div> <!-- Ends card -->
        </div> <!-- Ends the column for the card -->
        {% if forloop.last %}
          </div> <!-- Close last row -->
        {% endif %}
      {% endfor %} <!-- Loop has ended when all bikes are loaded -->
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
      function confirmDelete(bikeId) { // Function to confirm delete of the bikes
        if (confirm('Are you sure you want to delete this bike?')) { // Confirm alert
            fetch(`/api/${bikeId}/delete/`, { // Fetch with the URL
                method: 'DELETE', // Indicates the server that we want to delete a resource
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}' // Header X-CSRFToken to prevent CSRF attacks
                }
            }).then(response => { // With the servers's response we decide if delete or not
                if (response.ok) { // If response is ok
                    alert('Bike deleted successfully'); // Bike has been deleted
                    window.location.reload(); // Reloads the page
                } else { // If response is not ok
                    alert('Failed to delete bike');
                }
            });
        }
      }      
    </script>    
  </body>
</html>
